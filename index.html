<!--
    https://192.168.1.13
-->

<title>peeps</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/RecordRTC/5.6.1/RecordRTC.min.js"></script>

<script>
    let recorder;

    // recorder.startRecording();
    // recorder.stopRecording();

    navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
        recorder = new RecordRTC(stream, {
            mimeType: 'audio/wav',
            timeSlice: 1000,
            recorderType: RecordRTC.StereoAudioRecorder,
            numberOfAudioChannels: 1,
            audioBitsPerSecond: 128000
        });

        recorder.stopRecording(() => {
            const data = new FormData();

            data.append("file", recorder.getBlob(), 'recorder.wav');

            fetch('/chat/', {
                method: 'POST',
                body: data,
            })
            .then(response => response.blob())
            .then(blob => {
                new Audio(URL.createObjectURL(blob)).play();
            });
        });
    })
</script>